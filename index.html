<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Bouffe</title>

  <?php session_start(); ?>

  <script type="text/javascript">
    window.onload = function ()
    {
      if (localStorage.getItem("language") == null)
      {
        localStorage.setItem("language", "1");
      }
    }
  </script>

  <?php
   if (!isset($_SESSION["language"]))
   {
    $_SESSION["language"] = "1";
   }
   else
   {
     $lg = $_SESSION["language"];
     if ($lg == "1")
     {
      $_SESSION["language"] = "2";
     }
     else if ($lg == "2")
     {
      $_SESSION["language"] = "3";
     }
     else
     {
       $_SESSION["language"] = "1";
     }

     echo("language: " . $_SESSION["language"]);
   }
  ?>

</head>

<body>
  <?php
    include "srv/helper.php";
  ?>

  <form action="index.html">
    <input type="submit" value="Switch Language">
  </form>

<!-- 
  <button type="button" onclick="nextLanguage();">
    Switch language
  </button> -->

  <script type='text/javascript'>
    function nextLanguage()
    {
      if (localStorage.getItem("language") == null || localStorage.getItem("language") == "1")
      {
        localStorage.setItem("language", "2");
      }
      else if (localStorage.getItem("language") == "2")
      {
        localStorage.setItem("language", "3");
      }
      else
      {
        localStorage.setItem("language", "1");
      }

      window.location.reload();
    }
  </script>



  <h1>List</h1>

  <?php
  $p = dirname(__FILE__);


  $db_file = "$p/db/db";
  $db = new SQLite3("$db_file");

  $h = new Helper($db_file);
  echo $h->fetchWord("milk");
  echo "<br/>";


  $recipes_dir = "$p/src/";
  //print("$recipes_dir");
  foreach (new DirectoryIterator("$recipes_dir") as $fileInfo)
  {
    if ($fileInfo->isDot())
      continue;

    $path='/generated/' . $fileInfo->getFilename();
    echo "<a href=" . $path . ">" . $fileInfo->getFilename() . "</a>";
    echo "<br/>";
  }

  $query = "SELECT * FROM recipes;";
  $array['dbhandle'] = $db;
  $array['query'] = "$query";
  $result = $db->query($query);
  while ($row = $result->fetchArray())
  {
    $query_name = "SELECT name FROM words WHERE id={$row['id_word']};";
    $array['dbhandle'] = $db;
    $array['query'] = "$query_name";
    $recipe_name = $db->querySingle($query_name);
    echo "<a href=/srv/recipe.php?id={$row['id']}>" . "$recipe_name" . "</a><br/>";
  }

  ?>

  <h3><a href=srv/add_recipe.php>Add a recipe</a></h3>
</body>
</html>
